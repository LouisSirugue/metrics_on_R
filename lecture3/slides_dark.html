<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Basic data manipulation</title>
    <meta charset="utf-8" />
    <meta name="author" content=" Louis SIRUGUE" />
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="shortcut icon" href="star.png" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Basic data manipulation
## Lecture 3
### <br>Louis SIRUGUE
### CPES 2 - Fall 2022

---


&lt;style type="text/css"&gt;
body{background-color:black;filter:invert(1)}
&lt;/style&gt;



### Last time we saw

#### 1. Distributions

  * The **distribution** of a variable documents all its possible values and how frequent they are

--

&lt;img src="slides_files/figure-html/unnamed-chunk-2-1.png" width="95%" style="display: block; margin: auto;" /&gt;

--

&lt;p style = "margin-bottom:-1cm;"&gt;

 * We can describe a distribution with:
  
---

### Last time we saw

#### 1. Distributions

  * The **distribution** of a variable documents all its possible values and how frequent they are

&lt;img src="slides_files/figure-html/unnamed-chunk-3-1.png" width="95%" style="display: block; margin: auto;" /&gt;

&lt;p style = "margin-bottom:-1cm;"&gt;

 * We can describe a distribution with:
  * Its **central tendency**

---

### Last time we saw

#### 1. Distributions

  * The **distribution** of a variable documents all its possible values and how frequent they are

&lt;img src="slides_files/figure-html/unnamed-chunk-4-1.png" width="95%" style="display: block; margin: auto;" /&gt;

&lt;p style = "margin-bottom:-1cm;"&gt;

 * We can describe a distribution with:
  * Its **central tendency**
  * And its **spread**
  
---

### Last time we saw

#### 2. Central tendency

--

.pull-left[

 * The **mean** is the sum of all values divided by the number of observations

`$$\bar{x} = \frac{1}{N}\sum_{i = 1}^Nx_i$$` 

]

--

.pull-right[

 * The **median** is the value that divides the (sorted) distribution into two groups of equal size

`$$\text{Med}(x) = \begin{cases} x[\frac{N+1}{2}] &amp; \text{if } N \text{ is odd}\\
\frac{x[\frac{N}{2}]+x[\frac{N}{2}+1]}{2} &amp; \text{if } N \text{ is even}
\end{cases}$$`

]

--

#### 3. Spread

--

.pull-left[

 * The **standard deviation** is square root of the average squared deviation from the mean

`$$\text{SD}(x) = \sqrt{\text{Var}(x)} = \sqrt{\frac{1}{N}\sum_{i = 1}^N(x_i-\bar{x})^2}$$`
 
]

--

.pull-right[

&lt;p style = "margin-bottom:-5.5cm;"&gt;&lt;/p&gt;

 * The **interquartile range** is the difference between the maximum and the minimum value from the middle half of the distribution

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

$$\text{IQR} = Q_3 - Q_1 $$

]

---

### Last time we saw

#### 4. Inference

&lt;ul&gt; 
  &lt;li&gt;In Statistics, we view variables as a given realization of a &lt;b&gt;data generating process&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Hence, the &lt;b&gt;mean&lt;/b&gt; is what we call an &lt;b&gt;empirical moment&lt;/b&gt;, which is an &lt;b&gt;estimation&lt;/b&gt;...&lt;/li&gt;
    &lt;li&gt;... of the &lt;b&gt;expected value&lt;/b&gt;, the &lt;b&gt;theoretical moment&lt;/b&gt; of the DGP we're interested in&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

&lt;ul&gt; 
  &lt;li&gt;To know how confident we can be in this estimation, we need to compute a &lt;b&gt;confidence interval&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;

`$$[\bar{x} - t_{n-1, \:97.5\%}\times\frac{\text{SD}(x)}{\sqrt{n}}; \:\bar{x} + t_{n-1, \:97.5\%}\times\frac{\text{SD}(x)}{\sqrt{n}}]$$`

--

&lt;ul&gt;
  &lt;ul&gt;
    &lt;li&gt;It gets &lt;b&gt;larger&lt;/b&gt; as the &lt;b&gt;variance&lt;/b&gt; of the distribution of \(x\) increases&lt;/li&gt;
    &lt;li&gt;And gets &lt;b&gt;smaller&lt;/b&gt; as the &lt;b&gt;sample size&lt;/b&gt; \(n\) increases&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

&lt;img src="slides_files/figure-html/unnamed-chunk-5-1.png" width="95%" style="display: block; margin: auto;" /&gt;

---

&lt;h3&gt;Today we learn how to manipulate data&lt;/h3&gt;

--

&lt;p style = "margin-bottom:2cm;"&gt;

#### 1. Datasets
&lt;p style = "margin-bottom:-.5cm;"&gt;
 * 1.1. What is a dataset
 * 1.2. Import and eyeball data
 * 1.3. Subset data

#### 2. The dplyr grammar
&lt;p style = "margin-bottom:-.5cm;"&gt;
 * 2.1. Basic functions
 * 2.2. Group by and summarise
 * 2.3. Merge and append data
 * 2.4. Reshape data

#### 3. Wrap up!

---

&lt;h3&gt;Today we learn how to manipulate data&lt;/h3&gt;

&lt;p style = "margin-bottom:2cm;"&gt;

#### 1. Datasets
&lt;p style = "margin-bottom:-.5cm;"&gt;
 * 1.1. What is a dataset
 * 1.2. Import and eyeball data
 * 1.3. Subset data

---

### 1. Datasets

#### 1.1. What is a dataset?

&amp;#10140; &lt;b&gt;Datasets&lt;/b&gt; are typically tables in which each &lt;b&gt;row&lt;/b&gt; corresponds to an &lt;b&gt;observation&lt;/b&gt; and each &lt;b&gt;column&lt;/b&gt; to a &lt;b&gt;variable&lt;/b&gt;

--

&lt;p style = "margin-bottom:-.25cm;"&gt;

&lt;style&gt; .left-column {width: 22%;} .right-column {width: 75%;} &lt;/style&gt;

.left-column[

&lt;p style = "margin-bottom:1.5cm;"&gt;

#### Observations can be:
&lt;p style = "margin-bottom:-.5cm;"&gt;
 * Individuals
 * Countries
 * Years

&lt;p style = "margin-bottom:1cm;"&gt;

#### Variables can be:
&lt;p style = "margin-bottom:-.5cm;"&gt;
 * Age
 * GDP
 * Temperature
]

--

.right-column[
&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Excerpt of a dataset on cereals&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; name &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; calories &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; protein &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; fat &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; sodium &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; fiber &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; vitamins &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 100% Bran &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 130 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 10.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 100% Natural Bran &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 120 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 15 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; All-Bran &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 260 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; All-Bran with Extra Fiber &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 50 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 140 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 14.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Almond Delight &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 110 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 200 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Apple Cinnamon Cheerios &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 110 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 180 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Apple Jacks &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 110 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 125 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Basic 4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 130 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 210 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---

### 1. Datasets

#### 1.1. What is a dataset?

 * Each column of a dataset can be seen as a &lt;b&gt;vector&lt;/b&gt; whose &lt;b&gt;n&lt;sup&gt;th&lt;/sup&gt; element&lt;/b&gt; is about the &lt;b&gt;n&lt;sup&gt;th&lt;/sup&gt; individual&lt;/b&gt;
   * This is how we can create a dataset: by assigning vectors to variable names in a data object

--


```r
departments &lt;- data.frame(code = 1:4,
                          department = c("Ain", "Aisne", "Allier", "Alpes-de-Haute-Provence"),
                          capital = c("Bourg-en-Bresse", "Laon", "Moulin", "Digne-les-bains"))

print(departments, row.names = F)
```
--

```
##  code              department         capital
##     1                     Ain Bourg-en-Bresse
##     2                   Aisne            Laon
##     3                  Allier          Moulin
##     4 Alpes-de-Haute-Provence Digne-les-bains
```

&lt;p style = "margin-bottom:1.25cm;"&gt;

--

 * This illustrates what datasets are made of, but the point is not to write datasets ourselves 
 
&lt;p style = "margin-bottom:-.35cm;"&gt;

--

&lt;center&gt;&lt;b&gt; &amp;#10140; We need to import data in R &lt;/b&gt;&lt;/center&gt;

---

### 1. Datasets

#### 1.2. Import and eyeball data

&lt;ul&gt;
  &lt;li&gt;There are &lt;b&gt;various formats&lt;/b&gt; of datasets, and as many ways to import them in R&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;A very common format is the &lt;b&gt;.csv&lt;/b&gt; (for &lt;i&gt;Comma Separated Values&lt;/i&gt;), which basically looks like that:&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;


```r
1,Ain,Bourg-en-Bresse
2,Aisne,Laon
3,Allier,Moulin         
4,Alpes-de-Haute-Provence,Digne-les-bains
```

--

To **import** csv data, you can use **`read.csv()`**. This function has **many parameters** you can change to import the data the way you want. Here are a few of them:
 * `skip`: how many **lines to skip** before reading the data
 * `header`: whether the first row contains **variables names**
 * `sep`: the **character** that **separates** each observations in the csv (usually `","` or `";"`)
 * `fileEncoding`: if the data contain **special characters** you should set the right encoding

--


```r
iris &lt;- read.csv("iris.csv", skip = 0, header = TRUE, sep = ",", encoding = "UTF-8")
```

&lt;!-- *Other data formats such xls, dta, sas, etc., typically have their own read function, very similar to this one.* --&gt;

---

### 1. Datasets

#### 1.2. Import and eyeball data

 * The `head` function prints the **first rows** of a dataset  


```r
head(iris, 12) # Show the first 12 rows of the data
```
--

```
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1           5.1         3.5          1.4         0.2  setosa
## 2           4.9         3.0          1.4         0.2  setosa
## 3           4.7         3.2          1.3         0.2  setosa
## 4           4.6         3.1          1.5         0.2  setosa
## 5           5.0         3.6          1.4         0.2  setosa
## 6           5.4         3.9          1.7         0.4  setosa
## 7           4.6         3.4          1.4         0.3  setosa
## 8           5.0         3.4          1.5         0.2  setosa
## 9           4.4         2.9          1.4         0.2  setosa
## 10          4.9         3.1          1.5         0.1  setosa
## 11          5.4         3.7          1.5         0.2  setosa
## 12          4.8         3.4          1.6         0.2  setosa
```

---

### 1. Datasets

#### 1.2. Import and eyeball data

 *  The `view` function opens the **data in a new tab** in the code panel. It should look like that:


```r
view(iris)
```

--

&lt;center&gt;
&lt;img src = "view.png" width = "550"/&gt;
&lt;/center&gt;

---

### 1. Datasets

#### 1.2. Import and eyeball data

&lt;p style = "margin-bottom:.5cm;"&gt;

 * You can obtain the **dimension** of the data with the `dim()` function


```r
dim(iris)
```
--

```
## [1] 150   5
```

The data has 150 rows and 5 columns

--

&lt;p style = "margin-bottom:1.75cm;"&gt;

 * You can access to the **variable names** with the `names()` function


```r
names(iris)
```
--

```
## [1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"
```

---

### 1. Datasets

#### 1.2. Import and eyeball data

 *  The function `summary()` allows you to get a concise **description of each variable** in your data
 

```r
summary(iris, digits = 2) # Choose how to round numeric values with 'digits'
```
--

```
##   Sepal.Length  Sepal.Width   Petal.Length  Petal.Width    Species         
##  Min.   :4.3   Min.   :2.0   Min.   :1.0   Min.   :0.1   Length:150        
##  1st Qu.:5.1   1st Qu.:2.8   1st Qu.:1.6   1st Qu.:0.3   Class :character  
##  Median :5.8   Median :3.0   Median :4.3   Median :1.3   Mode  :character  
##  Mean   :5.8   Mean   :3.1   Mean   :3.8   Mean   :1.2                     
##  3rd Qu.:6.4   3rd Qu.:3.3   3rd Qu.:5.1   3rd Qu.:1.8                     
##  Max.   :7.9   Max.   :4.4   Max.   :6.9   Max.   :2.5
```

--

&lt;p style = "margin-bottom:.75cm;"&gt;

**&amp;#10140; What we learn:**
&lt;p style = "margin-bottom:-.25cm;"&gt;
 * `Petal`/`Sepal.Lengths`/`Widths` are **numeric** while `Species` is a **character** variable
 * From the **mean** and the **range** of numeric variables: 
  * Petals tend to be smaller than sepals (for irises)
  * The range of numeric variables is quite large

---

### 1. Datasets

#### 1.2. Import and eyeball data


&lt;ul&gt;
  &lt;li&gt;In R you can handle datasets in &lt;b&gt;different formats&lt;/b&gt;:&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;data.frame&lt;/li&gt;
    &lt;li&gt;tibble&lt;/li&gt;
    &lt;li&gt;matrix&lt;/li&gt;
    &lt;li&gt;data.table&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

&lt;ul&gt;
  &lt;li&gt;All these formats have their specificities&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;In this course we'll focus on &lt;b&gt;data.frames&lt;/b&gt; and &lt;b&gt;tibbles&lt;/b&gt; (very similar) &lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:-.25cm;"&gt;

--

&lt;ul&gt;
  &lt;li&gt;One specificity of the &lt;b&gt;tibble&lt;/b&gt; can be observed when printing the data:&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;It will display its &lt;b&gt;dimensions&lt;/b&gt; (#rows \(\times\) #columns) and the &lt;b&gt;class&lt;/b&gt; of each variable under its name&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;


```r
head(as_tibble(iris), 2)
```
--

```
## # A tibble: 2 x 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  
## 1          5.1         3.5          1.4         0.2 setosa 
## 2          4.9         3            1.4         0.2 setosa
```

---

### 1. Datasets

#### 1.3. Subset data: Extract values

&lt;ul&gt;
  &lt;li&gt;Just as with vectors, you can &lt;b&gt;access elements&lt;/b&gt; of the data using &lt;b&gt;[]&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;But while vectors have 1 dimension, datasets have &lt;b&gt;two dimensions&lt;/b&gt;: rows and columns&lt;/li&gt;
    &lt;li&gt;To access specific cells of the data, you must indicate the &lt;b&gt;row number(s)&lt;/b&gt; and the &lt;b&gt;column number(s)&lt;/b&gt; &lt;i&gt;separated by a comma in the brackets&lt;/i&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

```r
iris[5, 2] # Fifth observation of the second variable
```
--

```
## [1] 3.6
```
--

```r
iris[2, ] # Second observation of each variable
```
--

```
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 2          4.9           3          1.4         0.2  setosa
```
--

```r
iris[c(3, 6), 4] # Observations 3 and 6 of the fourth variable
```
--

```
## [1] 0.2 0.4
```

---

### 1. Datasets

#### 1.3. Subset data: Get variables

 * The **`$`** allows to &lt;b&gt;access a variable&lt;/b&gt; of the data


```r
iris$Sepal.Length
```
--

```
##   [1] 5.1 4.9 4.7 4.6 5.0 5.4 4.6 5.0 4.4 4.9 5.4 4.8 4.8 4.3 5.8 5.7 5.4 5.1
##  [19] 5.7 5.1 5.4 5.1 4.6 5.1 4.8 5.0 5.0 5.2 5.2 4.7 4.8 5.4 5.2 5.5 4.9 5.0
##  [37] 5.5 4.9 4.4 5.1 5.0 4.5 4.4 5.0 5.1 4.8 5.1 4.6 5.3 5.0 7.0 6.4 6.9 5.5
##  [55] 6.5 5.7 6.3 4.9 6.6 5.2 5.0 5.9 6.0 6.1 5.6 6.7 5.6 5.8 6.2 5.6 5.9 6.1
##  [73] 6.3 6.1 6.4 6.6 6.8 6.7 6.0 5.7 5.5 5.5 5.8 6.0 5.4 6.0 6.7 6.3 5.6 5.5
##  [91] 5.5 6.1 5.8 5.0 5.6 5.7 5.7 6.2 5.1 5.7 6.3 5.8 7.1 6.3 6.5 7.6 4.9 7.3
## [109] 6.7 7.2 6.5 6.4 6.8 5.7 5.8 6.4 6.5 7.7 7.7 6.0 6.9 5.6 7.7 6.3 6.7 7.2
## [127] 6.2 6.1 6.4 7.2 7.4 7.9 6.4 6.3 6.1 7.7 6.3 6.4 6.0 6.9 6.7 6.9 5.8 6.8
## [145] 6.7 6.7 6.3 6.5 6.2 5.9
```

--

 * Alternative solutions include using **double brackets** or the **column index**


```r
iris[["Sepal.Length"]]
iris[, 1] 
```

---

### 1. Datasets

#### 1.3. Subset data: Conditional subsetting

 * A **logical vector** (`T` and `F` / a condition) **before the comma** will select every **row** that meets this condition    


```r
iris[iris$Petal.Length &gt; 6.5, ]
```
--

```
##     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
## 106          7.6         3.0          6.6         2.1 virginica
## 118          7.7         3.8          6.7         2.2 virginica
## 119          7.7         2.6          6.9         2.3 virginica
## 123          7.7         2.8          6.7         2.0 virginica
```

--

 * A **logical vector** (`T` and `F` / a condition) **after the comma** will select every **column** that meets this condition    


```r
iris[iris$Petal.Length &gt; 6.5, names(iris) %in% c("Petal.Length", "Species")]
```
--

```
##     Petal.Length   Species
## 106          6.6 virginica
## 118          6.7 virginica
## 119          6.9 virginica
## 123          6.7 virginica
```

---

&lt;h3&gt;Overview&lt;/h3&gt;

&lt;p style = "margin-bottom:2cm;"&gt;

#### 1. Datasets &amp;#10004;
&lt;p style = "margin-bottom:-.5cm;"&gt;
 * 1.1. What is a dataset
 * 1.2. Import and eyeball data
 * 1.3. Subset data

#### 2. The dplyr grammar
&lt;p style = "margin-bottom:-.5cm;"&gt;
 * 2.1. Basic functions
 * 2.2. Group by and summarise
 * 2.3. Merge and append data
 * 2.4. Reshape data

#### 3. Wrap up!

---

&lt;h3&gt;Overview&lt;/h3&gt;

&lt;p style = "margin-bottom:2cm;"&gt;

#### 1. Datasets &amp;#10004;
&lt;p style = "margin-bottom:-.5cm;"&gt;
 * 1.1. What is a dataset
 * 1.2. Import and eyeball data
 * 1.3. Subset data
 
#### 2. The dplyr grammar
&lt;p style = "margin-bottom:-.5cm;"&gt;
 * 2.1. Basic functions
 * 2.2. Group by and summarise
 * 2.3. Merge and append data
 * 2.4. Reshape data

---

### 2. The `dplyr` grammar

#### 2.1. Basic functions 

`dplyr` is a **grammar** of data manipulation, providing very **user-friendly functions** to handle the most common **data manipulation** tasks. The functions you will probably use the most are the following:

--

 * `mutate()`: add/modify variables
 * `select()`: keep/drop variables (columns)
 * `filter()`: keep/drop observations (rows)
 * `arrange()`: sort rows according to the values of given variable(s)
 * `summarise()`: aggregate the data into descriptive statistics

--

.left-column[
&lt;img src = "pipe.png" width = "180"/&gt;
]

--

.right-column[

&lt;p style = "margin-bottom:1.25cm;"&gt;

&lt;ul&gt;
  &lt;li&gt;A very handy &lt;b&gt;operator&lt;/b&gt; to use with the &lt;b&gt;dplyr&lt;/b&gt; grammar is the &lt;b&gt;pipe %&gt;%&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:-.25cm;"&gt;

&lt;ul&gt;
  &lt;ul&gt;
    &lt;li&gt;You can basically read &lt;b&gt;a %&gt;% b()&lt;/b&gt; as &lt;i&gt;"apply function b() to object a"&lt;/i&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:-.25cm;"&gt;


&lt;ul&gt;
  &lt;ul&gt;
    &lt;li&gt;With this operator you can easily &lt;b&gt;chain the operations&lt;/b&gt; you apply to an object&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

]

---

### 2. The `dplyr` grammar

#### 2.1. Basic functions 


```r
iris %&gt;% 
  # Generate an new variable, the product of sepal length and width
  mutate(product = Sepal.Length * Sepal.Width) %&gt;%
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
  # Keep only this variable and the species in the dataset
  select(product, Species) %&gt;%
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
  # Keep only observations from the virginica species 
  filter(Species == "virginica") %&gt;%
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
  # Arrange rows by decreasing value of the product variable
  arrange(-product) %&gt;%
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
  # Show the first 5 observations
  head(5)
```
--

```
##   product   Species
## 1   30.02 virginica
## 2   29.26 virginica
## 3   25.92 virginica
## 4   23.10 virginica
## 5   23.04 virginica
```

---

### 2. The `dplyr` grammar

&lt;center&gt;&lt;h4&gt; &amp;#9888; &lt;i&gt;Be careful when chaining operations with pipes, it's easy to get mixed up!&lt;/i&gt; &amp;#9888; &lt;/h4&gt;&lt;/center&gt;

--

 * **Don't code blindfolded, `view()` your data at each step** to make sure that it goes the way you intend it to go 
 * Try to work on the subset of variables you actually need to make things easier

--


```r
iris %&gt;% 
  mutate(product = Sepal.Length * Sepal.Width) %&gt;%
  view()
```
--

```r
iris %&gt;% 
  mutate(product = Sepal.Length * Sepal.Width) %&gt;%
  select(product, Species) %&gt;%
  view()
```
--

```r
iris %&gt;% 
  mutate(product = Sepal.Length * Sepal.Width) %&gt;%
  select(product, Species) %&gt;%
  filter(Species == "virginica") %&gt;%
  view()
```

---

### 2. The `dplyr` grammar

#### 2.1. Basic functions: common mutate usage

 * Generate a variable as a function of other variables


```r
iris &lt;- iris %&gt;% mutate(new_var = (Sepal.Length * Sepal.Width) / 2)
```

--

 * Add a variable from elsewhere (dimensions must match)


```r
iris &lt;- iris %&gt;% mutate(new_var = 1:nrow(iris))
```

--

 * Use `ifelse(condition, value if condition is met, value if not)`


```r
iris &lt;- iris %&gt;% mutate(new_var = ifelse(Species == "virginica", 1, 0))
```

--

 * Use `case_when()` when there are more than 2 cases


```r
iris &lt;- iris %&gt;% mutate(new_var = case_when(Species == "versicolor" ~ "VER",
                                            Species == "virginica" ~ "VIR",
                                            Species == "setosa" ~ "SET"))
```

---

### 2. The `dplyr` grammar

#### 2.2. Group by and summarise

The `group_by()` function allows to modify the data **group by group** rather than on all observations

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Imagine that you are interested in &lt;b&gt;comparing&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;The average sepal width &lt;b&gt;by iris species&lt;/b&gt;&lt;/li&gt;
    &lt;li&gt;And the average sepal width &lt;b&gt;overall&lt;/b&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;


```r
iris_groups &lt;- iris %&gt;% # Let's save our modifications in a new dataset
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
  mutate(pop_mean = mean(Sepal.Width)) %&gt;% # First compute the mean of all observations
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
  group_by(Species) %&gt;% # Then group par specie
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
  mutate(group_mean = mean(Sepal.Width)) # And compute the mean
```



--

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt;

 * Let's view our data to see how it went


```r
view(iris_groups)
```

---

### 2. The `dplyr` grammar

&lt;center&gt;&lt;img src = "view3.png" width = 800/&gt;&lt;/center&gt;

---

### 2. The `dplyr` grammar

#### 2.2. Group by and summarise

&lt;ul&gt;
  &lt;li&gt;For each observation we now have the &lt;b&gt;average&lt;/b&gt; sepal width of its &lt;b&gt;specie&lt;/b&gt; and that of the whole &lt;b&gt;population&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;But these results are &lt;b&gt;not conveyed clearly&lt;/b&gt; because we still have individual-level info in the data&lt;/li&gt;
    &lt;li&gt;We should keep &lt;b&gt;only&lt;/b&gt; the &lt;b&gt;aggregated&lt;/b&gt; variables with one row per specie&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--


```r
iris_groups %&gt;% 
  select(Species, pop_mean, group_mean) %&gt;% # Select only the variables of interest
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
  unique() # Drop duplicate rows
```
--


```
## # A tibble: 3 x 3
## # Groups:   Species [3]
##   Species    pop_mean group_mean
##   &lt;chr&gt;         &lt;dbl&gt;      &lt;dbl&gt;
## 1 setosa         3.06       3.43
## 2 versicolor     3.06       2.77
## 3 virginica      3.06       2.97
```

--

&lt;p style = "margin-bottom:.75cm;"&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;We actually summarized the data into &lt;b&gt;descriptive statistics&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;This is precisely what the &lt;b&gt;summarise()&lt;/b&gt; function is made for&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

---

### 2. The `dplyr` grammar

#### 2.2. Group by and summarise

&lt;ul&gt;
  &lt;li&gt;The &lt;b&gt;summarise()&lt;/b&gt; function was made to &lt;b&gt;do it all&lt;/b&gt; that by itself:&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;u&gt;Step 1:&lt;/u&gt; Indicate at which level you want to aggregate the data by putting the &lt;b&gt;grouping variable&lt;/b&gt; in&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
  
&lt;p style = "margin-left:3.95cm;margin-top:-.5cm;margin-bottom:-.5cm;"&gt;&lt;b&gt;group_by()&lt;/b&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;u&gt;Step 2:&lt;/u&gt; Generate the aggregate variables by specifying &lt;b&gt;which variable&lt;/b&gt; you want &lt;b&gt;to aggregate&lt;/b&gt; and what&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-left:3.95cm;margin-top:-.5cm;margin-bottom:-.1cm;"&gt;&lt;b&gt;group-level information&lt;/b&gt; you want about it &lt;i&gt;(min, max, sum, number of observations, ...)&lt;/i&gt;&lt;/p&gt;


--


```r
iris %&gt;% group_by(Species) %&gt;%
  summarise(mean_length = mean(Sepal.Length),
            min_length = min(Sepal.Length),
            max_length = max(Sepal.Length),
            sum_width = sum(Sepal.Width),
            nb_obs = n())
```
--

```
## # A tibble: 3 x 6
##   Species    mean_length min_length max_length sum_width nb_obs
##   &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;  &lt;int&gt;
## 1 setosa            5.01        4.3        5.8      171.     50
## 2 versicolor        5.94        4.9        7        138.     50
## 3 virginica         6.59        4.9        7.9      149.     50
```

---

### 2. The `dplyr` grammar

####  2.2. Group by and summarise

Note that **`group_by()`** generally applies to **all operations until** you apply the **`ungroup()`** function 

--

* After computing the average sepal length by species, you may want to get the maximum value of that average:

--


```r
iris %&gt;%
  group_by(Species) %&gt;% # Group by species
  mutate(mean_length = mean(Sepal.Length)) %&gt;% # Compute the mean (by species)
  select(Species, mean_length) %&gt;% # Select the two variables we're interested in
  unique() %&gt;% # Drop duplicate row
```

--

&lt;p style = "margin-bottom:-.80cm;"&gt;&lt;/p&gt;


```r
  mutate(forgot_ungroup = max(mean_length)) %&gt;% # Compute max without ungroup
```

--

&lt;p style = "margin-bottom:-.80cm;"&gt;&lt;/p&gt;


```r
  ungroup() %&gt;% # Ungroup
  mutate(did_not_forget = max(mean_length)) # Compute max after ungroup
```
--

&lt;p style = "margin-bottom:-1cm;"&gt;&lt;/p&gt;

.pull-left[

```
## # A tibble: 3 x 4
##   Species    mean_length forgot_ungroup did_not_forget
##   &lt;chr&gt;            &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
## 1 setosa            5.01           5.01           6.59
## 2 versicolor        5.94           5.94           6.59
## 3 virginica         6.59           6.59           6.59
```
]

--

.right[
&lt;br&gt;
#### If you do not ungroup the data, 
&lt;p style = "margin-bottom:-.75cm;"&gt;&lt;/p&gt;
#### the maximum value is computed 
&lt;p style = "margin-bottom:-.75cm;"&gt;&lt;/p&gt;
#### *by* specie and not *across* species.
]

---

### Practice

**1) Import** `starbucks.csv` using the following command and **see what's wrong**


```r
starbucks &lt;- read.csv("YOUR_DIRECTORY/starbucks.csv")
```

&lt;center&gt;&lt;i&gt;Your directory must look like "C:/Users/...", &lt;b&gt;make sure to use / instead of \&lt;/b&gt;&lt;/i&gt;&lt;/center&gt;

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

**2) Set** the `sep` and `encoding` **arguments** of `read.csv` function to import the data **correctly**

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

**3)** Use `summarise()` to **compute** for each **beverage category** the average number of **calories** and the number of different **declinations** *(there is 1 row per declination)*

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

**4)** Create a **subset** of the data called `maxcal` containing the **variables** `Beverage_category`, `Beverage_prep`, and `Calories`, for the **10 observations** with the **highest calorie** values

&lt;center&gt;&lt;i&gt;You can use the row_number() function which gives the row numbers as a vector&lt;/i&gt;&lt;/center&gt;

--

&lt;center&gt;&lt;h3&gt;&lt;i&gt;You've got 10 minutes!&lt;/i&gt;&lt;/h3&gt;&lt;/center&gt;

---

### Solution

#### 1) Import `starbucks.csv` using the following command and see what's wrong


```r
read.csv("starbucks.csv") %&gt;% view()
```

&lt;img src = "view_starbucks.png" width = 600/&gt;

--

#### 2) Set the `sep` and `encoding` arguments of `read.csv` function to import the data correctly


```r
starbucks &lt;- read.csv("starbucks.csv", sep = ";", encoding = "UTF-8")
head(starbucks[4:5, 1:5])
```

```
##         Beverage_category      Beverage     Beverage_prep Calories Total.Fat
## 4                  Coffee Brewed Coffee             Venti        5       0.1
## 5 Classic Espresso Drinks   Caffè Latte Short Nonfat Milk       70       0.1
```

---

### Solution

#### 3) Use `summarise()` to compute for each beverage category the average number of calories and the number of different declinations (there is 1 row per declination)


```r
starbucks %&gt;%
  group_by(Beverage_category) %&gt;%
  summarise(Declinations = n(),
            Mean_cal = mean(Calories))
```

```
## # A tibble: 9 x 3
##   Beverage_category                 Declinations Mean_cal
##   &lt;chr&gt;                                    &lt;int&gt;    &lt;dbl&gt;
## 1 Classic Espresso Drinks                     58   140.  
## 2 Coffee                                       4     4.25
## 3 Frappuccino® Blended Coffee                 36   277.  
## 4 Frappuccino® Blended Crème                  13   233.  
## 5 Frappuccino® Light Blended Coffee           12   162.  
## 6 Shaken Iced Beverages                       18   114.  
## 7 Signature Espresso Drinks                   40   250   
## 8 Smoothies                                    9   282.  
## 9 Tazo® Tea Drinks                            52   177.
```

---

### Solution

#### 4) Create a subset of the data called `maxcal` containing the variables `Beverage_category`, `Beverage_prep`, and `Calories`, for the 10 observation with the highest calorie values


```r
maxcal &lt;- starbucks %&gt;%
  arrange(-Calories) %&gt;%
  select(Beverage_category, Beverage_prep, Calories) %&gt;%
  filter(row_number() &lt;= 10)

maxcal
```

```
##              Beverage_category     Beverage_prep Calories
## 1    Signature Espresso Drinks           2% Milk      510
## 2    Signature Espresso Drinks           Soymilk      460
## 3  Frappuccino® Blended Coffee        Whole Milk      460
## 4    Signature Espresso Drinks Venti Nonfat Milk      450
## 5             Tazo® Tea Drinks           2% Milk      450
## 6  Frappuccino® Blended Coffee           Soymilk      430
## 7  Frappuccino® Blended Coffee Venti Nonfat Milk      420
## 8    Signature Espresso Drinks           2% Milk      400
## 9             Tazo® Tea Drinks           Soymilk      390
## 10 Frappuccino® Blended Coffee        Whole Milk      390
```

---

### 2. The `dplyr` grammar

#### 2.3. Merge and append data

&lt;ul&gt;
  &lt;li&gt;Research projects often imply to &lt;b&gt;combine data&lt;/b&gt; from different sources&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;To &lt;b&gt;add observations&lt;/b&gt; (append rows)&lt;/li&gt;
    &lt;li&gt;To &lt;b&gt;add variables&lt;/b&gt; (merge columns)&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt;
&lt;center&gt;&lt;img src = "schema1.png"/&gt;&lt;/center&gt;

---

### 2. The `dplyr` grammar

#### 2.3. Merge and append data

&lt;ul&gt;
  &lt;li&gt;Research projects often imply to &lt;b&gt;combine data&lt;/b&gt; from different sources&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Either to &lt;b&gt;add observations&lt;/b&gt; (append rows)&lt;/li&gt;
    &lt;li&gt;Either to &lt;b&gt;add variables&lt;/b&gt; (merge columns)&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt;
&lt;center&gt;&lt;img src = "schema2.png"/&gt;&lt;/center&gt;

---

### 2. The `dplyr` grammar

#### 2.3. Merge and append data

&lt;ul&gt;
  &lt;li&gt;Research projects often imply to &lt;b&gt;combine data&lt;/b&gt; from different sources&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Either to &lt;b&gt;add observations&lt;/b&gt; (append rows)&lt;/li&gt;
    &lt;li&gt;Either to &lt;b&gt;add variables&lt;/b&gt; (merge columns)&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt; 
&lt;center&gt;&lt;img src = "schema3.png"/&gt;&lt;/center&gt;

---

### 2. The `dplyr` grammar

#### 2.3. Append data: The `bind_rows()` function

--
.pull-left[

```r
read.csv("attainment_FR_UK_US.csv")
```

```
##   country year share_tertiary
## 1     FRA 2015       44.68760
## 2     GBR 2015       49.94341
## 3     USA 2015       46.51771
```
]
--
.pull-right[

```r
read.csv("attainment_IT_SP.csv")
```

```
##   country year share_tertiary
## 1     ITA 2015       25.14996
## 2     ESP 2015       40.95978
```
]

--


```r
attainment &lt;- read.csv("attainment_FR_UK_US.csv") %&gt;%
  bind_rows(read.csv("attainment_IT_SP.csv"))
attainment
```

```
##   country year share_tertiary
## 1     FRA 2015       44.68760
## 2     GBR 2015       49.94341
## 3     USA 2015       46.51771
## 4     ITA 2015       25.14996
## 5     ESP 2015       40.95978
```

--

.pull-right[
&lt;p style = "margin-bottom:-4cm;"&gt;&lt;/p&gt;
**Variables** in the two datasets should be the same:
&lt;p style = "margin-bottom:-.5cm;"&gt;&lt;/p&gt;
 * **Same name**
 * **Same class**
]

---

### 2. The `dplyr` grammar

#### 2.3. Join data: `*_join()` functions

--

 * Join functions all work the same way:
  * A **dataset A** with a **variable X** and other variables
  * A **dataset B** with a **variable X** and other variables
  * X is the common variable, so datasets will be **joined *by* X**
  
--

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt;

&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;The 4 main join functions&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Function &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; For X in A &amp;amp; B &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; For X in A only &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; For X in B only &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Summary &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A %&amp;gt;% left_join(B, by = "X") &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Dropped &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Only keeps what's in A &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A %&amp;gt;% right_join(B, by = "X") &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Dropped &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Only keeps what's in B &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A %&amp;gt;% inner_join(B, by = "X") &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Dropped &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Dropped &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Only keeps what's common &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A %&amp;gt;% full_join(B, by = "X") &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Keeps everything &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

### 2. The `dplyr` grammar

&lt;center&gt;&lt;h4&gt; &amp;#9888; &lt;i&gt;Beware of NAs!&lt;/i&gt; &amp;#9888; &lt;/h4&gt;&lt;/center&gt;

&lt;ul&gt;
  &lt;li&gt;When you have &lt;b&gt;values&lt;/b&gt; of X that are &lt;b&gt;not common&lt;/b&gt; to both datasets&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Any other join than the inner_join() will &lt;b&gt;generate NAs&lt;/b&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--


```r
attainment %&gt;% full_join(read.csv("spending.csv"), by = "country")
```

```
##   country year.x share_tertiary year.y share_gdp
## 1     FRA   2015       44.68760   2015     3.398
## 2     GBR   2015       49.94341     NA        NA
## 3     USA   2015       46.51771   2015     3.207
## 4     ITA   2015       25.14996     NA        NA
## 5     ESP   2015       40.95978     NA        NA
## 6     RUS     NA             NA   2015     1.843
```

--

   * Any variable from `A` (`B`) other than those stated in `by= ` will be `NA` for observations that are only in `B` (`A`)  

  

   * This holds when a variable that is not mentioned in the `by= ` argument appears in both datasets:
     * In that case, R adds a data-specific suffix to the names and keeps them both
     * The variable from `B` (here `year.y`) will be `NA` for observations that are only in `A` only (here `GBR`, `ITA`, `ESP`)

---

### 2. The `dplyr` grammar

#### 2.3. Join data: example


```r
attainment %&gt;% left_join(read.csv("spending.csv"), by = "country")
```
--

```
##   country year.x share_tertiary year.y share_gdp
## 1     FRA   2015       44.68760   2015     3.398
## 2     GBR   2015       49.94341     NA        NA
## 3     USA   2015       46.51771   2015     3.207
## 4     ITA   2015       25.14996     NA        NA
## 5     ESP   2015       40.95978     NA        NA
```
--

```r
attainment %&gt;% right_join(read.csv("spending.csv"), by = "country")
```
--

```
##   country year.x share_tertiary year.y share_gdp
## 1     FRA   2015       44.68760   2015     3.398
## 2     USA   2015       46.51771   2015     3.207
## 3     RUS     NA             NA   2015     1.843
```
--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;center&gt;&lt;h4&gt;&lt;i&gt; &amp;#10140; What would be the result of an inner_join() here?&lt;/i&gt;&lt;/h4&gt;&lt;/center&gt;

---

### 2. The `dplyr` grammar

#### 2.4. Reshape data

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;It is important to be able to &lt;b&gt;switch from&lt;/b&gt; the &lt;b&gt;&lt;i&gt;long&lt;/i&gt; to&lt;/b&gt; the &lt;b&gt;&lt;i&gt;wide&lt;/i&gt;&lt;/b&gt; format and conversely&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Some computations should be done in one format or the other&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
 
 &lt;br&gt;
 
--

.pull-left[
&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Wide format&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; share_tertiary &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; share_gdp &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FRA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.69 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.40 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; USA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.21 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

--

.pull-right[
&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Long format&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Variable &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FRA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_tertiary &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.69 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FRA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_gdp &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.40 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; USA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_tertiary &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.52 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; USA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_gdp &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.21 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---

### 2. The `dplyr` grammar

#### 2.4. Reshape data: From wide to long with pivot_longer()

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;


```r
wide &lt;- attainment %&gt;% 
  inner_join(read.csv("spending.csv") %&gt;% select(-year), 
             by = "country")
wide
```
--

```
##   country year share_tertiary share_gdp
## 1     FRA 2015       44.68760     3.398
## 2     USA 2015       46.51771     3.207
```

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;i&gt; &amp;#10140; Pivoting to &lt;b&gt;long format&lt;/b&gt; can be seen as putting &lt;b&gt;variables on top of each other&lt;/b&gt; rather side to side &lt;/i&gt;

--

 * We need to indicate:
  * **Which variables to stack**
  * The **name of** the variable in which we want the **values** of the stacked variables to be stored
  * The **name of** the variable that will indicate to which **variable** corresponds each value

---

### 2. The `dplyr` grammar

#### 2.4. Reshape data: From wide to long with pivot_longer()

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;


```r
long &lt;- wide %&gt;%
               # Which variable to should be stacked
  pivot_longer(c(share_tertiary, share_gdp), 
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
               # Where their values should be stored
               values_to = "Value", 
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
               # Where to store which variable corresponds each value
               names_to = "Variable")
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
long
```


```
## # A tibble: 4 x 4
##   country  year Variable       Value
##   &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;
## 1 FRA      2015 share_tertiary 44.7 
## 2 FRA      2015 share_gdp       3.40
## 3 USA      2015 share_tertiary 46.5 
## 4 USA      2015 share_gdp       3.21
```

---

### 2. The `dplyr` grammar

#### 2.4. Reshape data: From long to wide with pivot_wider()

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;To &lt;b&gt;pivot in a wide&lt;/b&gt; format we need to indicate:&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;b&gt;Which variable&lt;/b&gt; contains &lt;b&gt;values&lt;/b&gt; of the variables we want to put side to side&lt;/li&gt;
    &lt;li&gt;&lt;b&gt;Which variable&lt;/b&gt; indicates which &lt;b&gt;variable&lt;/b&gt; correspond to each value&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

&lt;p style = "margin-bottom:.5cm;"&gt;&lt;/p&gt;


```r
wide &lt;- long %&gt;%
              # Where the values are
  pivot_wider(values_from = "Value", 
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
              # Where the corresponding variable names are
              names_from = "Variable")
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
wide
```


```
## # A tibble: 2 x 4
##   country  year share_tertiary share_gdp
##   &lt;chr&gt;   &lt;int&gt;          &lt;dbl&gt;     &lt;dbl&gt;
## 1 FRA      2015           44.7      3.40
## 2 USA      2015           46.5      3.21
```

---

&lt;h3&gt;Overview&lt;/h3&gt;

&lt;p style = "margin-bottom:2cm;"&gt;

#### 1. Datasets &amp;#10004;
&lt;p style = "margin-bottom:-.5cm;"&gt;
 * 1.1. What is a dataset
 * 1.2. Import and eyeball data
 * 1.3. Subset data
 
#### 2. The dplyr grammar &amp;#10004;
&lt;p style = "margin-bottom:-.5cm;"&gt;
 * 2.1. Basic functions
 * 2.2. Group by and summarise
 * 2.3. Merge and append data
 * 2.4. Reshape data
 
#### 3. Wrap up!

---

### 3. Wrap up!

#### Read data


```r
starbucks &lt;- read.csv("C:/User/Documents/folder/starbucks.csv", sep = ";", encoding = "UTF-8")
```

&lt;center&gt;&lt;b&gt;&lt;i&gt;&amp;#10140; Make sure to use / and not \&lt;/i&gt;&lt;/b&gt;&lt;/center&gt;

--

#### Chaining operations


```r
starbucks %&gt;%
  arrange(-Calories) %&gt;%
  select(Beverage_category, Beverage_prep, Calories) %&gt;%
  filter(row_number() &lt;= 3)
```

```
##             Beverage_category Beverage_prep Calories
## 1   Signature Espresso Drinks       2% Milk      510
## 2   Signature Espresso Drinks       Soymilk      460
## 3 Frappuccino® Blended Coffee    Whole Milk      460
```

&lt;p style = "margin-bottom:.8cm;"&gt;&lt;/p&gt;
&lt;center&gt;&lt;b&gt;&lt;i&gt;&amp;#10140; Make sure to view your data at each step&lt;/i&gt;&lt;/b&gt;&lt;/center&gt;

---

### 3. Wrap up!

&lt;p style = "margin-bottom:1.5cm;"&gt;&lt;/p&gt;

&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;&lt;b&gt;Important functions of the dplyr grammar&lt;/b&gt;&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Function &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Meaning &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; mutate() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Modify or create a variable &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; select() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Keep a subset of variables &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; filter() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Keep a subset of observations &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; arrange() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Sort the data &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; group_by() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Group the data &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; summarise() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Summarizes variables into 1 observation per group &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; bind_rows() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Append data &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; left/right/inner/full_join() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Merge data &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; pivot_longer/wider() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Reshape data &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
