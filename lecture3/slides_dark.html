<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Basic data manipulation</title>
    <meta charset="utf-8" />
    <meta name="author" content=" Louis SIRUGUE" />
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="shortcut icon" href="star.png" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Basic data manipulation
## Lecture 3
### <br>Louis SIRUGUE
### CPES 2 - Fall 2022

---


&lt;style&gt; .left-column {width: 65%;} .right-column {width: 31%;} &lt;/style&gt;

&lt;style type="text/css"&gt;
body{background-color:black;filter:invert(1)}
&lt;/style&gt;



### Quick reminder

#### 1. Distributions

  * The **distribution** of a variable documents all its possible values and how frequent they are

--

&lt;img src="slides_files/figure-html/unnamed-chunk-2-1.png" width="95%" style="display: block; margin: auto;" /&gt;

--

&lt;p style = "margin-bottom:-1cm;"&gt;

 * We can describe a distribution with:
  
---

### Quick reminder

#### 1. Distributions

  * The **distribution** of a variable documents all its possible values and how frequent they are

&lt;img src="slides_files/figure-html/unnamed-chunk-3-1.png" width="95%" style="display: block; margin: auto;" /&gt;

&lt;p style = "margin-bottom:-1cm;"&gt;

 * We can describe a distribution with:
  * Its **central tendency**

---

### Quick reminder

#### 1. Distributions

  * The **distribution** of a variable documents all its possible values and how frequent they are

&lt;img src="slides_files/figure-html/unnamed-chunk-4-1.png" width="95%" style="display: block; margin: auto;" /&gt;

&lt;p style = "margin-bottom:-1cm;"&gt;

 * We can describe a distribution with:
  * Its **central tendency**
  * And its **spread**
  
---

### Quick reminder

#### 2. Central tendency

--

.pull-left[

 * The **mean** is the sum of all values divided by the number of observations

`$$\bar{x} = \frac{1}{N}\sum_{i = 1}^Nx_i$$` 

]

--

.pull-right[

 * The **median** is the value that divides the (sorted) distribution into two groups of equal size

`$$\text{Med}(x) = \begin{cases} x[\frac{N+1}{2}] &amp; \text{if } N \text{ is odd}\\
\frac{x[\frac{N}{2}]+x[\frac{N}{2}+1]}{2} &amp; \text{if } N \text{ is even}
\end{cases}$$`

]

--

#### 3. Spread

--

.pull-left[

 * The **standard deviation** is square root of the average squared deviation from the mean

`$$\text{SD}(x) = \sqrt{\text{Var}(x)} = \sqrt{\frac{1}{N}\sum_{i = 1}^N(x_i-\bar{x})^2}$$`
 
]

--

.pull-right[

&lt;p style = "margin-bottom:-5.5cm;"&gt;&lt;/p&gt;

 * The **interquartile range** is the difference between the maximum and the minimum value from the middle half of the distribution

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

$$\text{IQR} = Q_3 - Q_1 $$

]

---

### Quick reminder

#### 4. Inference

&lt;ul&gt; 
  &lt;li&gt;In Statistics, we view variables as a given realization of a &lt;b&gt;data generating process&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Hence, the &lt;b&gt;mean&lt;/b&gt; is what we call an &lt;b&gt;empirical moment&lt;/b&gt;, which is an &lt;b&gt;estimation&lt;/b&gt;...&lt;/li&gt;
    &lt;li&gt;... of the &lt;b&gt;expected value&lt;/b&gt;, the &lt;b&gt;theoretical moment&lt;/b&gt; of the DGP we're interested in&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

&lt;ul&gt; 
  &lt;li&gt;To know how confident we can be in this estimation, we need to compute a &lt;b&gt;confidence interval&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;

`$$[\bar{x} - t_{n-1, \:97.5\%}\times\frac{\text{SD}(x)}{\sqrt{n}}; \:\bar{x} + t_{n-1, \:97.5\%}\times\frac{\text{SD}(x)}{\sqrt{n}}]$$`

--

&lt;ul&gt;
  &lt;ul&gt;
    &lt;li&gt;It gets &lt;b&gt;larger&lt;/b&gt; as the &lt;b&gt;variance&lt;/b&gt; of the distribution of \(x\) increases&lt;/li&gt;
    &lt;li&gt;And gets &lt;b&gt;smaller&lt;/b&gt; as the &lt;b&gt;sample size&lt;/b&gt; \(n\) increases&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

&lt;img src="slides_files/figure-html/unnamed-chunk-5-1.png" width="95%" style="display: block; margin: auto;" /&gt;

---

class: inverse, hide-logo

### Warm up practice

#### 1) Import the `ligue1.csv` dataset and store it in an object called `fb`

--

&lt;p style = "margin-bottom:1.5cm;"&gt;&lt;/p&gt;

#### 2) Create a subset of this dataset containing only matches that took place at 13h

--

&lt;p style = "margin-bottom:1.5cm;"&gt;&lt;/p&gt;

#### 3) Print the number of matches in this subset and compute the average attendance

--

&lt;p style = "margin-bottom:1.5cm;"&gt;&lt;/p&gt;

#### 4) Redo the same exercise on matches that took place at 20h45

--

&lt;p style = "margin-bottom:3cm;"&gt;&lt;/p&gt;

&lt;center&gt;&lt;h3&gt;&lt;i&gt;You've got 5 minutes!&lt;/i&gt;&lt;/h3&gt;&lt;/center&gt;

<div class="countdown" id="timer_7875216f" data-update-every="1" data-start-immediately="true" tabindex="0" style="top:0;right:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">05</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

class: inverse, hide-logo

### Solution

#### 1) Import the `ligue1.csv` dataset and store it in an object called `fb`

--


```r
fb &lt;- read.csv("C:/User/Documents/ligue1.csv", encoding = "UTF-8")
```



--

#### 2) Create a subset of this dataset containing only matches that took place at 13h

--


```r
sub13 &lt;- fb[fb$Time == "13:00", ]
```

--

#### 3) Print the number of matches in this subset and compute the average attendance

--


```r
nrow(sub13)
```

```
## [1] 32
```

--


```r
mean(sub13$Attendance)
```

```
## [1] NA
```

---

class: inverse, hide-logo

### Solution

&lt;ul&gt;
  &lt;li&gt;When there are &lt;b&gt;missing values&lt;/b&gt; in a vector, the &lt;b&gt;mean&lt;/b&gt; function returns &lt;b&gt;NA&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;We need to set the &lt;b&gt;na.rm&lt;/b&gt; option to &lt;b&gt;TRUE&lt;/b&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

#### 3) Print the number of matches in this subset and compute the average attendance


```r
mean(sub13$Attendance, na.rm = T)
```

```
## [1] 19038
```

--

#### 4) Redo the same exercise on matches that took place at 20h45

--


```r
sub2045 &lt;- fb[fb$Time == "20:45", ]
nrow(sub2045)
```

```
## [1] 29
```

```r
mean(sub2045$Attendance, na.rm = T)
```

```
## [1] 36418.64
```

---

&lt;h3&gt;Today we learn how to manipulate data&lt;/h3&gt;

&lt;p style = "margin-bottom:3cm;"&gt;&lt;/p&gt;

.pull-left[

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;1. The dplyr package&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;1.1. Packages&lt;/li&gt;
    &lt;li&gt;1.2. Basic functions&lt;/li&gt;
    &lt;li&gt;1.3. group_by() and summarise()&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:2.25cm;"&gt;&lt;/p&gt;

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;2. Merge and reshape&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;2.1. Merge and append data&lt;/li&gt;
    &lt;li&gt;2.2. Reshape data&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

]

.pull-right[

&lt;ul style = "margin-left:-1cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;3. A few words on learning R&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;3.1. When it doesn't work the way you want&lt;/li&gt;
    &lt;li&gt;3.2. Where to find help&lt;/li&gt;
    &lt;li&gt;3.3. When it doesn't work at all&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
 
&lt;p style = "margin-bottom:2.25cm;"&gt;&lt;/p&gt;

&lt;ul style = "margin-left:-1cm;list-style: none"&gt;&lt;li&gt;&lt;b&gt;4. Wrap up!&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;
]

---

&lt;h3&gt;Today we learn how to manipulate data&lt;/h3&gt;

&lt;p style = "margin-bottom:3cm;"&gt;&lt;/p&gt;

.pull-left[

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;1. The dplyr package&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;1.1. Packages&lt;/li&gt;
    &lt;li&gt;1.2. Basic functions&lt;/li&gt;
    &lt;li&gt;1.3. group_by() and summarise()&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

]

---

### 1. The `dplyr` package

#### 1.1. Packages

&lt;ul&gt;
  &lt;li&gt;So far we only used functions that are directly available in R&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;But there are tons of &lt;b&gt;user-created functions&lt;/b&gt; out there that can make your life so much easier&lt;/li&gt;
    &lt;li&gt;These functions are shared in what we call &lt;b&gt;packages&lt;/b&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Packages are &lt;b&gt;bundles of functions&lt;/b&gt; that R users put at the disposal of other R users&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Packages are &lt;b&gt;centralized&lt;/b&gt; on the &lt;a href = "https://cran.r-project.org/"&gt;Comprehensive R Archive Network (CRAN)&lt;/a&gt;&lt;/li&gt;
    &lt;li&gt;To &lt;b&gt;download&lt;/b&gt; and install a CRAN package you can simply use &lt;b&gt;install.packages()&lt;/b&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;All the functions of the dplyr grammar are gathered in the &lt;b&gt;dplyr package&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;We can download these functions and make them ready to use with the install.packages() function&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--


```r
install.packages("dplyr") # Requires an internet connection
```

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The tidyverse package is &lt;b&gt;now installed&lt;/b&gt; on your computer&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;You won't have to do it again&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
 
---

### 1. The `dplyr` package

#### 1.1. Packages

 * The `dplyr` package is now &lt;b&gt;on your computer&lt;/b&gt;, but it is &lt;b&gt;not loaded in R&lt;/b&gt;

--





```r
ls("package:dplyr")
```

```
## Error in as.environment(pos): no item called "package:dplyr" on the search list
```

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;You need to use the &lt;b&gt;library()&lt;/b&gt; command to load it&lt;/li&gt;
&lt;/ul&gt;

--


```r
library(dplyr)
ls("package:dplyr")[1:5]
```

```
## [1] "%&gt;%"        "across"     "add_count"  "add_count_" "add_row"
```

--

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;But even though the package is permanently installed, it is &lt;b&gt;loaded only for your current session&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Each time you start a &lt;b&gt;new R session&lt;/b&gt;, you'll have to load the packages you need with &lt;b&gt;library()&lt;/b&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

---

### 1. The `dplyr` package

#### 1.2. Basic functions


`dplyr` is a **grammar** of data manipulation providing very **user-friendly functions** to handle the most common **data manipulation** tasks:

--

 * `mutate()`: add/modify variables
 * `select()`: keep/drop variables (columns)
 * `filter()`: keep/drop observations (rows)
 * `arrange()`: sort rows according to the values of given variable(s)
 * `summarise()`: aggregate the data into descriptive statistics

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;img src = "pipe.png" width = "180"/&gt;

--


&lt;p style = "margin-bottom:-5cm;"&gt;&lt;/p&gt;

&lt;ul style = "margin-left:6cm;"&gt;
  &lt;li&gt;A very handy &lt;b&gt;operator&lt;/b&gt; to use with the &lt;b&gt;dplyr&lt;/b&gt; grammar is the &lt;b&gt;pipe %&gt;%&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:-.25cm;"&gt;

&lt;ul style = "margin-left:6cm;"&gt;
  &lt;ul&gt;
    &lt;li&gt;You can basically read &lt;b&gt;a %&gt;% b()&lt;/b&gt; as &lt;i&gt;"apply function b() to object a"&lt;/i&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:-.25cm;"&gt;


&lt;ul style = "margin-left:6cm;"&gt;
  &lt;ul&gt;
    &lt;li&gt;With this operator you can easily &lt;b&gt;chain the operations&lt;/b&gt; you apply to an object&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

---

### 1. The `dplyr` package

#### 1.2. Basic functions




```r
fb 
                                                    #
                                                    #
                                                    #
                                                    #
                                                    #
                                                    #
```


```text
##     Wk Day       Date  Time          Home  xG Score xG.1          Away Attendance  ...
## 1    1 Fri 2021-08-06 21:00        Monaco 2.0   1–1  0.3        Nantes       7500  ...
## 2    1 Sat 2021-08-07 17:00          Lyon 1.4   1–1  0.8         Brest      29018  ...
## 3    1 Sat 2021-08-07 21:00        Troyes 0.8   1–2  1.2     Paris S-G      15248  ...
## 4    1 Sun 2021-08-08 13:00        Rennes 0.6   1–1  2.0          Lens      22567  ...
## 5    1 Sun 2021-08-08 15:00      Bordeaux 0.7   0–2  3.3 Clermont Foot      18748  ...
## 6    1 Sun 2021-08-08 15:00    Strasbourg 0.4   0–2  0.9        Angers      23250  ...
## 7    1 Sun 2021-08-08 15:00          Nice 0.8   0–0  0.2         Reims      18030  ...
## 8    1 Sun 2021-08-08 15:00 Saint-Étienne 2.1   1–1  1.3       Lorient      20461  ...
## 9    1 Sun 2021-08-08 17:00          Metz 0.7   3–3  1.4         Lille      15551  ...
 ...  ... ...        ...   ...           ... ...   ...  ...           ...        ...  ...                      
```


---

### 1. The `dplyr` package

#### 1.2. Basic functions


```r
fb %&gt;%
  select(Home, xG, Score, xG.1, Away)               # Keep/drop certain columns
                                                    #
                                                    #
                                                    #
                                                    #
                                                    #
```


```text
##              Home  xG Score xG.1          Away
## 1          Monaco 2.0   1–1  0.3        Nantes
## 2            Lyon 1.4   1–1  0.8         Brest
## 3          Troyes 0.8   1–2  1.2     Paris S-G
## 4          Rennes 0.6   1–1  2.0          Lens
## 5        Bordeaux 0.7   0–2  3.3 Clermont Foot
## 6      Strasbourg 0.4   0–2  0.9        Angers
## 7            Nice 0.8   0–0  0.2         Reims
## 8   Saint-Étienne 2.1   1–1  1.3       Lorient
## 9            Metz 0.7   3–3  1.4         Lille
 ...             ... ...   ...  ...           ...
```

---

### 1. The `dplyr` package

#### 1.2. Basic functions


```r
fb %&gt;%
  select(Home, xG, Score, xG.1, Away) %&gt;%           # Keep/drop certain columns
  mutate(home_winner = xG &gt; xG.1)                   # Create a new variable
                                                    #
                                                    #
                                                    #
                                                    #
```



```text
##              Home  xG Score xG.1          Away home_winner
## 1          Monaco 2.0   1–1  0.3        Nantes        TRUE
## 2            Lyon 1.4   1–1  0.8         Brest        TRUE
## 3          Troyes 0.8   1–2  1.2     Paris S-G       FALSE
## 4          Rennes 0.6   1–1  2.0          Lens       FALSE
## 5        Bordeaux 0.7   0–2  3.3 Clermont Foot       FALSE
## 6      Strasbourg 0.4   0–2  0.9        Angers       FALSE
## 7            Nice 0.8   0–0  0.2         Reims        TRUE
## 8   Saint-Étienne 2.1   1–1  1.3       Lorient        TRUE
## 9            Metz 0.7   3–3  1.4         Lille       FALSE
 ...             ... ...   ...  ...           ...         ...
```

---

### 1. The `dplyr` package

#### 1.2. Basic functions


```r
fb %&gt;%
  select(Home, xG, Score, xG.1, Away) %&gt;%           # Keep/drop certain columns
  mutate(home_winner = xG &gt; xG.1) %&gt;%               # Create a new variable
  filter(Home == "Rennes")                          # Keep/drop certain rows 
                                                    #
                                                    #
                                                    #
```


```text
##      Home  xG Score xG.1          Away home_winner
## 1  Rennes 0.6   1–1  2.0          Lens       FALSE
## 2  Rennes 0.9   1–0  0.5        Nantes        TRUE
## 3  Rennes 1.0   0–2  0.5         Reims        TRUE
## 4  Rennes 2.4   6–0  0.3 Clermont Foot        TRUE
## 5  Rennes 0.8   2–0  1.4     Paris S-G       FALSE
## 6  Rennes 1.5   1–0  0.6    Strasbourg        TRUE
## 7  Rennes 3.8   4–1  1.1          Lyon        TRUE
## 8  Rennes 3.1   2–0  0.7   Montpellier        TRUE
## 9  Rennes 0.8   1–2  0.6         Lille        TRUE
         ... ...   ...  ...           ...         ...
```

---

### 1. The `dplyr` package

#### 1.2. Basic functions


```r
fb %&gt;%
  select(Home, xG, Score, xG.1, Away) %&gt;%           # Keep/drop certain columns
  mutate(home_winner = xG &gt; xG.1) %&gt;%               # Create a new variable
  filter(Home == "Rennes") %&gt;%                      # Keep/drop certain rows
  arrange(-xG)                                      # Sort rows
                                                    #
                                                    #
```


```text
##      Home  xG Score xG.1          Away home_winner
## 1  Rennes 3.8   4–1  1.1          Lyon        TRUE
## 2  Rennes 3.3   6–0  0.4      Bordeaux        TRUE
## 3  Rennes 3.3   6–1  0.9          Metz        TRUE
## 4  Rennes 3.1   2–0  0.7   Montpellier        TRUE
## 5  Rennes 2.7   2–0  0.3         Brest        TRUE
## 6  Rennes 2.6   4–1  0.4        Troyes        TRUE
## 7  Rennes 2.4   6–0  0.3 Clermont Foot        TRUE
## 8  Rennes 1.9   2–3  2.9        Monaco       FALSE
## 9  Rennes 1.7   2–0  0.3        Angers        TRUE
         ... ...   ...  ...           ...         ...
```

---

### 1. The `dplyr` package

#### 1.2. Basic functions


```r
fb %&gt;%
  select(Home, xG, Score, xG.1, Away) %&gt;%           # Keep/drop certain columns
  mutate(home_winner = xG &gt; xG.1) %&gt;%               # Create a new variable
  filter(Home == "Rennes") %&gt;%                      # Keep/drop certain rows
  arrange(-xG) %&gt;%                                  # Sort rows
  summarise(expected_wins = mean(home_winner),      # Aggregate into statistics
            expected_goals = sum(xG))               #
```

```
##   expected_wins expected_goals
## 1     0.8421053           36.6
```

---

### 1. The `dplyr` package

#### 1.2. Basic functions

 * Here are two very **handy functions** to use within `mutate()`
   
  &lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

--

.pull-left[
&lt;center&gt;&lt;b&gt;ifelse&lt;/b&gt;&lt;/center&gt;


```r
fb %&gt;%
  select(Home, Attendance) %&gt;%  
  mutate(att_bin = ifelse(Attendance &gt; 10000, 
                          "Large", 
                          "Low")
         ) %&gt;% head()
```

```
##         Home Attendance att_bin
## 1     Monaco       7500     Low
## 2       Lyon      29018   Large
## 3     Troyes      15248   Large
## 4     Rennes      22567   Large
## 5   Bordeaux      18748   Large
## 6 Strasbourg      23250   Large
```
]

--

.pull-right[
&lt;center&gt;&lt;b&gt;case_when&lt;/b&gt;&lt;/center&gt;


```r
fb %&gt;%
  select(Home, xG, xG.1, Away) %&gt;%  
  mutate(xWin = case_when(xG &gt; xG.1 ~ "Home",
                          xG == xG.1 ~ "Draw",
                          xG &lt; xG.1 ~ "Away")
         ) %&gt;% head()
```

```
##         Home  xG xG.1          Away xWin
## 1     Monaco 2.0  0.3        Nantes Home
## 2       Lyon 1.4  0.8         Brest Home
## 3     Troyes 0.8  1.2     Paris S-G Away
## 4     Rennes 0.6  2.0          Lens Away
## 5   Bordeaux 0.7  3.3 Clermont Foot Away
## 6 Strasbourg 0.4  0.9        Angers Away
```
]

---

### 1. The `dplyr` package

#### 1.3. group_by() and summarise()

 * With `group_by()` you can perform **computations separately** for the different **categories of a variable**

--

.pull-left[

```r
fb %&gt;%
  select(Wk, Home, xG) %&gt;%
  mutate(all.xG = mean(xG)) %&gt;%
  head(10)
```

```
##    Wk          Home  xG   all.xG
## 1   1        Monaco 2.0 1.473421
## 2   1          Lyon 1.4 1.473421
## 3   1        Troyes 0.8 1.473421
## 4   1        Rennes 0.6 1.473421
## 5   1      Bordeaux 0.7 1.473421
## 6   1    Strasbourg 0.4 1.473421
## 7   1          Nice 0.8 1.473421
## 8   1 Saint-Étienne 2.1 1.473421
## 9   1          Metz 0.7 1.473421
## 10  1   Montpellier 0.5 1.473421
```
]

--

.pull-right[

```r
fb %&gt;%
  select(Wk, Home, xG) %&gt;%
* group_by(Home) %&gt;%
  mutate(home.xG = mean(xG)) %&gt;%
  head(6)
```

```
## # A tibble: 6 x 4
## # Groups:   Home [6]
##      Wk Home          xG home.xG
##   &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;
## 1     1 Monaco       2      1.69
## 2     1 Lyon         1.4    2.07
## 3     1 Troyes       0.8    1.21
## 4     1 Rennes       0.6    1.93
## 5     1 Bordeaux     0.7    1.23
## 6     1 Strasbourg   0.4    1.73
```
]

---

### 1. The `dplyr` package

#### 1.3. group_by() and summarise()

&lt;ul&gt;
  &lt;li&gt;It is particularly &lt;b&gt;useful with summarise()&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;summarise keeps the grouping variable&lt;/li&gt;
    &lt;li&gt;and computes &lt;b&gt;statistics for each category&lt;/b&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

.pull-left[


```r
fb %&gt;%
  group_by(Wk) %&gt;%
  summarise(n = n(),
            tot_xG = sum(xG)+sum(xG.1),
            avg_WG = tot_xG/n) %&gt;%
  head(4)
```

```
## # A tibble: 4 x 4
##      Wk     n tot_xG avg_WG
##   &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1    10   23.4   2.34
## 2     2    10   26.6   2.66
## 3     3    10   25.7   2.57
## 4     4    10   30.4   3.04
```


]

--


.pull-right[

&lt;p style = "margin-top:-6.3em"&gt;&lt;/p&gt;

&lt;center&gt;&lt;b&gt;mutate() \(\neq\) summarise()&lt;/b&gt;&lt;/center&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;b&gt;mutate()&lt;/b&gt; takes an operation that converts:&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;b&gt;A vector into another vector&lt;/b&gt;&lt;/li&gt;
  &lt;/ul&gt;
  &lt;li&gt;&lt;b&gt;summarise()&lt;/b&gt; takes an operation that converts:&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;b&gt;A vector into a value&lt;/b&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
]

--


.pull-right[

&lt;p style = "margin-top:-15.5em"&gt;&lt;/p&gt;

&lt;center&gt;&lt;b&gt;Ungrouping&lt;/b&gt;&lt;/center&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;b&gt;group_by()&lt;/b&gt; applies to all subsequent operations&lt;/li&gt;
  &lt;li&gt;To cancel its effect you must &lt;b&gt;ungroup()&lt;/b&gt; the data&lt;/li&gt;
&lt;/ul&gt;


```r
fb %&gt;% 
  group_by(Wk) %&gt;% 
  mutate(test = mean(xG)) %&gt;% 
* ungroup() %&gt;%
  ...
```
]

---

class: inverse, hide-logo

### Practice

#### 1) Start from the `fb` dataset and keep only the variables `Home`, `Score` and `Away`

--

#### 2) Use the `separate()` function from `tidyr` to split the `Score` variable into `home_score` and `away_score`


```r
data.frame(x = "a_b") %&gt;% 
  separate(x, c("x", "y"), "_")
```

```
##   x y
## 1 a b
```

--

#### 3) Convert these two variables into numeric vectors

--

#### 4) Create a variable named `winner` that takes the values `Home`, `Draw` and `Away` depending on the score

--

#### 5) Use `group_by()` and `summarise() `to compute the percentage of draws, home wins and away wins

--

&lt;center&gt;&lt;h3&gt;&lt;i&gt;You've got 10 minutes!&lt;/i&gt;&lt;/h3&gt;&lt;/center&gt;

<div class="countdown" id="timer_90b53c70" data-update-every="1" data-start-immediately="true" tabindex="0" style="top:0;right:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---

class: inverse, hide-logo

### Solution

#### 1) Start from the `fb` dataset and keep only the variables `Home`, `Score` and `Away`

--


```r
fb %&gt;% 
* select(Home, Score, Away) %&gt;%
  head(2)
```

--


```
##     Home Score   Away
## 1 Monaco   1-1 Nantes
## 2   Lyon   1-1  Brest
```

--

#### 2) Use the `separate()` function from `tidyr` to split the `Score` variable into `home_score` and `away_score`

--


```r
fb %&gt;% 
  select(Home, Score, Away) %&gt;% 
* separate(Score, c("home_score", "away_score"), "-") %&gt;%
  head(2)
```

--


```
##     Home home_score away_score   Away
## 1 Monaco          1          1 Nantes
## 2   Lyon          1          1  Brest
```

---

class: inverse, hide-logo

### Solution

#### 3) Convert these two variables into numeric vectors

#### 4) Create a variable named `winner` that takes the values `Home`, `Draw` and `Away` depending on the score

--


```r
fb %&gt;% 
  select(Home, Score, Away) %&gt;% 
  separate(Score, c("home_score", "away_score"), "-") %&gt;%
* mutate(home_score = as.numeric(home_score),
*        away_score = as.numeric(away_score),
*        winner = case_when(home_score &lt; away_score ~ "Away",
*                           home_score == away_score ~ "Draw",
*                           home_score &gt; away_score ~ "Home")) %&gt;%
  head()
```

--


```
##         Home home_score away_score          Away winner
## 1     Monaco          1          1        Nantes   Draw
## 2       Lyon          1          1         Brest   Draw
## 3     Troyes          1          2     Paris S-G   Away
## 4     Rennes          1          1          Lens   Draw
## 5   Bordeaux          0          2 Clermont Foot   Away
## 6 Strasbourg          0          2        Angers   Away
```

---

class: inverse, hide-logo

### Solution

#### 5) Use `group_by()` and `summarise() `to compute the percentage of draws, home wins and away wins

--


```r
fb %&gt;% 
  select(Home, Score, Away) %&gt;% 
  separate(Score, c("home_score", "away_score"), "-") %&gt;%
  mutate(home_score = as.numeric(home_score),
         away_score = as.numeric(away_score),
         winner = case_when(home_score &lt; away_score ~ "Away",
                            home_score == away_score ~ "Draw",
                            home_score &gt; away_score ~ "Home")) %&gt;%
* group_by(winner) %&gt;%
* summarise(pct = 100 * (n() / nrow(fb)))
```

--


```
## # A tibble: 3 x 2
##   winner   pct
##   &lt;chr&gt;  &lt;dbl&gt;
## 1 Away    30.5
## 2 Draw    26.8
## 3 Home    42.6
```

---

&lt;h3&gt;Overview&lt;/h3&gt;

&lt;p style = "margin-bottom:3cm;"&gt;&lt;/p&gt;

.pull-left[

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;1. The dplyr package &amp;#10004;&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;1.1. Packages&lt;/li&gt;
    &lt;li&gt;1.2. Basic functions&lt;/li&gt;
    &lt;li&gt;1.3. group_by() and summarise()&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:2.25cm;"&gt;&lt;/p&gt;

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;2. Merge and reshape&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;2.1. Merge and append data&lt;/li&gt;
    &lt;li&gt;2.2. Reshape data&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

]

.pull-right[

&lt;ul style = "margin-left:-1cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;3. A few words on learning R&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;3.1. When it doesn't work the way you want&lt;/li&gt;
    &lt;li&gt;3.2. Where to find help&lt;/li&gt;
    &lt;li&gt;3.3. When it doesn't work at all&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
 
&lt;p style = "margin-bottom:2.25cm;"&gt;&lt;/p&gt;

&lt;ul style = "margin-left:-1cm;list-style: none"&gt;&lt;li&gt;&lt;b&gt;4. Wrap up!&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;
]

---

&lt;h3&gt;Overview&lt;/h3&gt;

&lt;p style = "margin-bottom:3cm;"&gt;&lt;/p&gt;

.pull-left[

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;1. The dplyr package &amp;#10004;&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;1.1. Packages&lt;/li&gt;
    &lt;li&gt;1.2. Basic functions&lt;/li&gt;
    &lt;li&gt;1.3. group_by() and summarise()&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:2.25cm;"&gt;&lt;/p&gt;

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;2. Merge and reshape&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;2.1. Merge and append data&lt;/li&gt;
    &lt;li&gt;2.2. Reshape data&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
]

---

### 2. Merge and reshape

#### 2.1. Merge and append data

&lt;ul&gt;
  &lt;li&gt;Research projects often imply to &lt;b&gt;combine data&lt;/b&gt; from different sources&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Either to &lt;b&gt;add observations&lt;/b&gt; (append rows)&lt;/li&gt;
    &lt;li&gt;Either to &lt;b&gt;add variables&lt;/b&gt; (merge columns)&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt;
&lt;center&gt;&lt;img src = "schema1.png"/&gt;&lt;/center&gt;

---

### 2. Merge and reshape

#### 2.1. Merge and append data

&lt;ul&gt;
  &lt;li&gt;Research projects often imply to &lt;b&gt;combine data&lt;/b&gt; from different sources&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Either to &lt;b&gt;add observations&lt;/b&gt; (append rows)&lt;/li&gt;
    &lt;li&gt;Either to &lt;b&gt;add variables&lt;/b&gt; (merge columns)&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt;
&lt;center&gt;&lt;img src = "schema2.png"/&gt;&lt;/center&gt;

---

### 2. Merge and reshape

#### 2.1. Merge and append data

&lt;ul&gt;
  &lt;li&gt;Research projects often imply to &lt;b&gt;combine data&lt;/b&gt; from different sources&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Either to &lt;b&gt;add observations&lt;/b&gt; (append rows)&lt;/li&gt;
    &lt;li&gt;Either to &lt;b&gt;add variables&lt;/b&gt; (merge columns)&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt; 
&lt;center&gt;&lt;img src = "schema3.png"/&gt;&lt;/center&gt;

---

### 2. Merge and reshape

#### 2.1. Merge and append data: The `bind_rows()` function

--
.pull-left[

```r
read.csv("attainment_FR_UK_US.csv")
```

```
##   country year share_tertiary
## 1     FRA 2015       44.68760
## 2     GBR 2015       49.94341
## 3     USA 2015       46.51771
```
]
--
.pull-right[

```r
read.csv("attainment_IT_SP.csv")
```

```
##   country year share_tertiary
## 1     ITA 2015       25.14996
## 2     ESP 2015       40.95978
```
]

--


```r
attainment &lt;- read.csv("attainment_FR_UK_US.csv") %&gt;%
  bind_rows(read.csv("attainment_IT_SP.csv"))
attainment
```

```
##   country year share_tertiary
## 1     FRA 2015       44.68760
## 2     GBR 2015       49.94341
## 3     USA 2015       46.51771
## 4     ITA 2015       25.14996
## 5     ESP 2015       40.95978
```

--

.pull-right[
&lt;p style = "margin-bottom:-4cm;"&gt;&lt;/p&gt;
**Variables** in the two datasets should be the same:
&lt;p style = "margin-bottom:-.5cm;"&gt;&lt;/p&gt;
 * **Same name**
 * **Same class**
]

---

### 2. Merge and reshape

#### 2.1. Merge and append data: `*_join()` functions

--

 * Join functions all work the same way:
  * A **dataset A** with a **variable X** and other variables
  * A **dataset B** with a **variable X** and other variables
  * X is the common variable, so datasets will be **joined *by* X**
  
--

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt;

&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;The 4 main join functions&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Function &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; For X in A &amp;amp; B &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; For X in A only &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; For X in B only &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Summary &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A %&amp;gt;% left_join(B, by = "X") &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Dropped &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Only keeps what's in A &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A %&amp;gt;% right_join(B, by = "X") &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Dropped &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Only keeps what's in B &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A %&amp;gt;% inner_join(B, by = "X") &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Dropped &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Dropped &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Only keeps what's common &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; A %&amp;gt;% full_join(B, by = "X") &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Kept &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Keeps everything &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

### 2. Merge and reshape

&lt;center&gt;&lt;h4&gt; &amp;#9888; &lt;i&gt;Beware of NAs!&lt;/i&gt; &amp;#9888; &lt;/h4&gt;&lt;/center&gt;

&lt;ul&gt;
  &lt;li&gt;When you have &lt;b&gt;values&lt;/b&gt; of X that are &lt;b&gt;not common&lt;/b&gt; to both datasets&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Any other join than the inner_join() will &lt;b&gt;generate NAs&lt;/b&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--


```r
attainment %&gt;% full_join(read.csv("spending.csv"), by = "country")
```

```
##   country year.x share_tertiary year.y share_gdp
## 1     FRA   2015       44.68760   2015     3.398
## 2     GBR   2015       49.94341     NA        NA
## 3     USA   2015       46.51771   2015     3.207
## 4     ITA   2015       25.14996     NA        NA
## 5     ESP   2015       40.95978     NA        NA
## 6     RUS     NA             NA   2015     1.843
```

--

   * Any variable from `A` (`B`) other than those stated in `by= ` will be `NA` for observations that are only in `B` (`A`)  

  

   * This holds when a variable that is not mentioned in the `by= ` argument appears in both datasets:
     * In that case, R adds a data-specific suffix to the names and keeps them both
     * The variable from `B` (here `year.y`) will be `NA` for observations that are only in `A` only (here `GBR`, `ITA`, `ESP`)

---

### 2. Merge and reshape

#### 2.1. Merge and append data: example


```r
attainment %&gt;% left_join(read.csv("spending.csv"), by = "country")
```
--

```
##   country year.x share_tertiary year.y share_gdp
## 1     FRA   2015       44.68760   2015     3.398
## 2     GBR   2015       49.94341     NA        NA
## 3     USA   2015       46.51771   2015     3.207
## 4     ITA   2015       25.14996     NA        NA
## 5     ESP   2015       40.95978     NA        NA
```
--

```r
attainment %&gt;% right_join(read.csv("spending.csv"), by = "country")
```
--

```
##   country year.x share_tertiary year.y share_gdp
## 1     FRA   2015       44.68760   2015     3.398
## 2     USA   2015       46.51771   2015     3.207
## 3     RUS     NA             NA   2015     1.843
```
--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;center&gt;&lt;h4&gt;&lt;i&gt; &amp;#10140; What would be the result of an inner_join() here?&lt;/i&gt;&lt;/h4&gt;&lt;/center&gt;

---

### 2. Merge and reshape

#### 2.2. Reshape data

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;It is important to be able to &lt;b&gt;switch from&lt;/b&gt; the &lt;b&gt;&lt;i&gt;long&lt;/i&gt; to&lt;/b&gt; the &lt;b&gt;&lt;i&gt;wide&lt;/i&gt;&lt;/b&gt; format and conversely&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Some computations should be done in one format or the other&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
 
 &lt;br&gt;
 
--

.pull-left[
&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Wide format&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; share_tertiary &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; share_gdp &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FRA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.69 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.40 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; USA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.21 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

--

.pull-right[
&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;Long format&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Variable &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FRA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_tertiary &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.69 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FRA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_gdp &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.40 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; USA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_tertiary &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.52 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; USA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_gdp &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.21 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

---

### 2. Merge and reshape

#### 2.2. Reshape data: From wide to long with pivot_longer()

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;


```r
wide &lt;- attainment %&gt;% 
  inner_join(read.csv("spending.csv") %&gt;% select(-year), 
             by = "country")
wide
```
--

```
##   country year share_tertiary share_gdp
## 1     FRA 2015       44.68760     3.398
## 2     USA 2015       46.51771     3.207
```

--

&lt;p style = "margin-bottom:1.5cm;"&gt;&lt;/p&gt;

&lt;i&gt; &amp;#10140; Pivoting to &lt;b&gt;long format&lt;/b&gt; can be seen as putting &lt;b&gt;variables on top of each other&lt;/b&gt; rather side to side &lt;/i&gt;

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt;

--

 * We need to indicate:
  * **Which variables to stack**
  * The **name of** the variable in which we want the **values** of the stacked variables to be stored
  * The **name of** the variable that will indicate to which **variable** corresponds each value

---

### 2. Merge and reshape

#### 2.2. Reshape data: From wide to long with pivot_longer()

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;


```r
long &lt;- wide %&gt;%
               # Which variable to should be stacked
  pivot_longer(c(share_tertiary, share_gdp), 
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
               # Where their values should be stored
               values_to = "Value", 
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
               # Where to store which variable corresponds each value
               names_to = "Variable")
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
long
```


```
## # A tibble: 4 x 4
##   country  year Variable       Value
##   &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;
## 1 FRA      2015 share_tertiary 44.7 
## 2 FRA      2015 share_gdp       3.40
## 3 USA      2015 share_tertiary 46.5 
## 4 USA      2015 share_gdp       3.21
```

---

### 2. Merge and reshape

#### 2.2. Reshape data: From long to wide with pivot_wider()

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;To &lt;b&gt;pivot in a wide&lt;/b&gt; format we need to indicate:&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;b&gt;Which variable&lt;/b&gt; contains &lt;b&gt;values&lt;/b&gt; of the variables we want to put side to side&lt;/li&gt;
    &lt;li&gt;&lt;b&gt;Which variable&lt;/b&gt; indicates which &lt;b&gt;variable&lt;/b&gt; correspond to each value&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

&lt;p style = "margin-bottom:.5cm;"&gt;&lt;/p&gt;


```r
wide &lt;- long %&gt;%
              # Where the values are
  pivot_wider(values_from = "Value", 
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
              # Where the corresponding variable names are
              names_from = "Variable")
```
--
&lt;p style = "margin-bottom:-1.01cm;"&gt;&lt;/p&gt;

```r
wide
```


```
## # A tibble: 2 x 4
##   country  year share_tertiary share_gdp
##   &lt;chr&gt;   &lt;int&gt;          &lt;dbl&gt;     &lt;dbl&gt;
## 1 FRA      2015           44.7      3.40
## 2 USA      2015           46.5      3.21
```

---
class: inverse, hide-logo

### Practice

#### 1) From the `fb` dataset, create a variable `league` equal to `"ligue1"` and a variable `season` equal to `"2021-2022"` and save this new data in an object named `full_fb`

--

#### 2) In data.zip you will find the rest of the data for the seasons 2019-2020 to 2021-2022 for the league 1, the bundesliga and the premier league. Append all these data to `full_fb`. Make sure to create the variables `league` and `season` in each data set before appending.

--

#### 3) Use the `separate` function from `tidyr` to extract the number of goals scored by the home and away team

--

#### 4) Convert these variables as numeric and create a variable equal to the sum of the goals from the two teams

--

#### 5) Summarise your data into the total number of goals score per league/season

--

#### 6) Reshape your data such that you have 1 row per league and 1 column per season

--

&lt;center&gt;&lt;h3&gt;&lt;i&gt;You've got 10 minutes!&lt;/i&gt;&lt;/h3&gt;&lt;/center&gt;

<div class="countdown" id="timer_b189cec2" data-update-every="1" data-start-immediately="true" tabindex="0" style="top:0;right:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
class: inverse, hide-logo

### Solution

#### 1) From the `fb` dataset, create a variable `league` equal to `"ligue1"` and a variable `season` equal to `"2021-2022"` and save this new data in an object named `full_fb`

--


```r
full_fb &lt;- fb %&gt;% mutate(league = "ligue1", season = "2021-2022")
```

--

#### 2) In data.zip you will find the rest of the data for the seasons 2019-2020 to 2021-2022 for the league 1, the bundesliga and the premier league. Append all these data to `full_fb`. Make sure to create the variables `league` and `season` in each data set before appending.

--


```r
full_fb &lt;- full_fb %&gt;%
  bind_rows(read.csv("ligue1_2021.csv") %&gt;% mutate(league = "ligue1", season = "2020-2021")) %&gt;%
  bind_rows(read.csv("ligue1_1920.csv") %&gt;% mutate(league = "ligue1", season = "2019-2020")) %&gt;%
  bind_rows(read.csv("preml_2122.csv") %&gt;% mutate(league = "preml", season = "2021-2022")) %&gt;%
  bind_rows(read.csv("preml_2021.csv") %&gt;% mutate(league = "preml", season = "2020-2021")) %&gt;%
  bind_rows(read.csv("preml_1920.csv") %&gt;% mutate(league = "preml", season = "2019-2020")) %&gt;%
  bind_rows(read.csv("bundes_2122.csv") %&gt;% mutate(league = "bundes", season = "2021-2022")) %&gt;%
  bind_rows(read.csv("bundes_2021.csv") %&gt;% mutate(league = "bundes", season = "2020-2021")) %&gt;%
  bind_rows(read.csv("bundes_1920.csv") %&gt;% mutate(league = "bundes", season = "2019-2020"))
```

---
class: inverse, hide-logo

### Solution

#### 3) Use the `separate` function from `tidyr` to extract the number of goals scored by the home and away team

--


```r
full_fb &lt;- full_fb %&gt;%
  separate(Score, c("home_score", "away_score"), "-") 
```

--

#### 4) Convert these variables as numeric and create a variable equal to the sum of the goals from the two teams

--


```r
full_fb &lt;- full_fb %&gt;%
  mutate(home_score = as.numeric(home_score),
         away_score = as.numeric(away_score),
         goals = home_score + away_score) 
```

--

#### 5) Summarise your data into the total number of goals score per league/season

--


```r
full_fb &lt;- full_fb %&gt;%
  group_by(league, season) %&gt;%
  summarise(goals = sum(goals))
```

---
class: inverse, hide-logo

### Solution

#### 6) Reshape your data such that you have 1 row per league and 1 column per season

--


```r
full_fb %&gt;%
  pivot_wider(names_from = "season", values_from = "goals")
```

```
## # A tibble: 3 x 4
## # Groups:   league [3]
##   league `2019-2020` `2020-2021` `2021-2022`
##   &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 bundes         982         928         954
## 2 ligue1         704        1049        1067
## 3 preml         1034        1024        1071
```

---

&lt;h3&gt;Overview&lt;/h3&gt;

&lt;p style = "margin-bottom:3cm;"&gt;&lt;/p&gt;

.pull-left[

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;1. The dplyr package &amp;#10004;&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;1.1. Packages&lt;/li&gt;
    &lt;li&gt;1.2. Basic functions&lt;/li&gt;
    &lt;li&gt;1.3. group_by() and summarise()&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:2.25cm;"&gt;&lt;/p&gt;

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;2. Merge and reshape &amp;#10004;&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;2.1. Merge and append data&lt;/li&gt;
    &lt;li&gt;2.2. Reshape data&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

]

.pull-right[

&lt;ul style = "margin-left:-1cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;3. A few words on learning R&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;3.1. When it doesn't work the way you want&lt;/li&gt;
    &lt;li&gt;3.2. Where to find help&lt;/li&gt;
    &lt;li&gt;3.3. When it doesn't work at all&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
 
&lt;p style = "margin-bottom:2.25cm;"&gt;&lt;/p&gt;

&lt;ul style = "margin-left:-1cm;list-style: none"&gt;&lt;li&gt;&lt;b&gt;4. Wrap up!&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;
]

---

&lt;h3&gt;Overview&lt;/h3&gt;

&lt;p style = "margin-bottom:3cm;"&gt;&lt;/p&gt;

.pull-left[

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;1. The dplyr package &amp;#10004;&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;1.1. Packages&lt;/li&gt;
    &lt;li&gt;1.2. Basic functions&lt;/li&gt;
    &lt;li&gt;1.3. group_by() and summarise()&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:2.25cm;"&gt;&lt;/p&gt;

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;2. Merge and reshape &amp;#10004;&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;2.1. Merge and append data&lt;/li&gt;
    &lt;li&gt;2.2. Reshape data&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

]

.pull-right[

&lt;ul style = "margin-left:-1cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;3. A few words on learning R&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;3.1. When it doesn't work the way you want&lt;/li&gt;
    &lt;li&gt;3.2. Where to find help&lt;/li&gt;
    &lt;li&gt;3.3. When it doesn't work at all&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
]

---

### 3. A few words on learning R

#### 3.1. When it doesn't work the way you want

&lt;ul&gt;
  &lt;li&gt;When things do not work the way you want, &lt;b&gt;NAs are the usual suspects&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;For instance, this is how the mean function reacts to NAs:&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
 
--


```r
mean(c(1, 2, NA))
```

```
## [1] NA
```
--

```r
mean(c(1, 2, NA), na.rm = T)
```

```
## [1] 1.5
```

&lt;p style = "margin-bottom:1.25cm;"&gt;&lt;/p&gt;

--

&lt;ul&gt;
  &lt;li&gt;You should systematically &lt;b&gt;check for NAs!&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;

--
 

```r
is.na(c(1, 2, NA))
```

```
## [1] FALSE FALSE  TRUE
```

---

### 3. A few words on learning R

#### 3.1. When it doesn't work the way you want

&lt;ul&gt;
  &lt;li&gt;&lt;b&gt;Don't pipe blindfolded!&lt;/b&gt;&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;b&gt;Check&lt;/b&gt; that each command does what it's expected to do&lt;/li&gt;
    &lt;li&gt;View or print your data &lt;b&gt;at each step&lt;/b&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--


```r
fb %&gt;% 
  select(Home, Score, Away) %&gt;%
  head(1)
```

--


```
##     Home Score   Away
## 1 Monaco   1-1 Nantes
```

--


```r
fb %&gt;% 
  select(Home, Score, Away) %&gt;% 
  separate(Score, c("home_score", "away_score"), "-") %&gt;%
  head(1)
```

--


```
##     Home home_score away_score   Away
## 1 Monaco          1          1 Nantes
```

---

### 3. A few words on learning R

#### 3.2. Where to find help

&lt;ul&gt;
  &lt;li&gt;Oftentimes things don't work either because:&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;b&gt;You don't understand&lt;/b&gt; a function's argument&lt;/li&gt;
    &lt;li&gt;Or &lt;b&gt;you don't know&lt;/b&gt; that there exists an argument that you should use&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

&lt;ul&gt;
  &lt;li&gt;This is precisely what &lt;b&gt;help files&lt;/b&gt; are made for&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Every function has a help file, just enter &lt;b&gt;?&lt;/b&gt; and the name of your &lt;b&gt;function&lt;/b&gt; in the console&lt;/li&gt;
    &lt;li&gt;The help file will &lt;b&gt;pop up in the Help tab&lt;/b&gt; of R studio&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;
 

```r
?paste
```

--

&lt;center&gt;
&lt;img src = "paste_help.png"/&gt;
&lt;/center&gt;

---

### 3. A few words on learning R

#### 3.2. Where to find help

&lt;ul&gt;
  &lt;li&gt;Search on the internet!&lt;/li&gt;
  &lt;ul&gt;
    &lt;li&gt;Your question is for sure already asked and answered on &lt;a href = "https://stackoverflow.com/"&gt;stackoverflow&lt;/a&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
 
--

&lt;center&gt;
&lt;img src = "ask_google.png" width = 750 /&gt;
&lt;/center&gt;

---

### 3. A few words on learning R

#### 3.3. When it doesn't work at all

 * Sometimes R breaks and returns an &lt;b&gt;error&lt;/b&gt; (usually kind of cryptic)

--


```r
read.csv("C:\Users\Documents\R")
```

```
## Error: '\U' used without hex digits in character string starting ""C:\U"
```

--

&lt;p style = "margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Look for &lt;b&gt;keywords&lt;/b&gt; that might help you understand where it comes from&lt;/li&gt;
  &lt;li&gt;Paste in on &lt;b&gt;Google&lt;/b&gt; with the name of your command&lt;/li&gt;
&lt;/ol&gt;

--

&lt;center&gt;
&lt;img src = "error.png" width = 750 /&gt;
&lt;/center&gt;

---

&lt;h3&gt;Overview&lt;/h3&gt;

&lt;p style = "margin-bottom:3cm;"&gt;&lt;/p&gt;

.pull-left[

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;1. The dplyr package &amp;#10004;&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;1.1. Packages&lt;/li&gt;
    &lt;li&gt;1.2. Basic functions&lt;/li&gt;
    &lt;li&gt;1.3. group_by() and summarise()&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

&lt;p style = "margin-bottom:2.25cm;"&gt;&lt;/p&gt;

&lt;ul style = "margin-left:1.5cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;2. Merge and reshape &amp;#10004;&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;2.1. Merge and append data&lt;/li&gt;
    &lt;li&gt;2.2. Reshape data&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;

]

.pull-right[

&lt;ul style = "margin-left:-1cm;list-style: none"&gt;
  &lt;li&gt;&lt;b&gt;3. A few words on learning R &amp;#10004;&lt;/b&gt;&lt;/li&gt;
  &lt;ul style = "list-style: none"&gt;
    &lt;li&gt;3.1. When it doesn't work the way you want&lt;/li&gt;
    &lt;li&gt;3.2. Where to find help&lt;/li&gt;
    &lt;li&gt;3.3. When it doesn't work at all&lt;/li&gt;
  &lt;/ul&gt;
&lt;/ul&gt;
 
&lt;p style = "margin-bottom:2.25cm;"&gt;&lt;/p&gt;

&lt;ul style = "margin-left:-1cm;list-style: none"&gt;&lt;li&gt;&lt;b&gt;4. Wrap up!&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;
]

---

### 4. Wrap up!

#### 1. Packages


```r
library(dplyr)
```

--

&lt;p style = "margin-bottom:1.5cm;"&gt;&lt;/p&gt;

#### 2. Main dplyr functions

.left-column[
&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Function &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Meaning &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; mutate() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Modify or create a variable &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; select() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Keep a subset of variables &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; filter() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Keep a subset of observations &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; arrange() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Sort the data &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; group_by() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Group the data &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; summarise() &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Summarizes variables into 1 observation per group &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

--

.right-column[
&lt;img style = "margin-top:0cm; margin-left:1.5cm;" src = "pipe.png" width = "180"/&gt;
]

---

### 4. Wrap up!

#### 3. Merge data


```r
a &lt;- data.frame(x = c(1, 2, 3), y = c("a", "b", "c"))
b &lt;- data.frame(x = c(4, 5, 6), y = c("d", "e", "f"))
c &lt;- data.frame(x = 1:6, z = c("alpha", "bravo", "charlie", "delta", "echo", "foxtrot"))
```

--


```r
a %&gt;% bind_rows(b) %&gt;% left_join(c, by = "x")
```

&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; x &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; y &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; z &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; a &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; alpha &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; b &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; bravo &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; c &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; charlie &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 4 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; d &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; delta &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; e &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; echo &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 6 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; f &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; foxtrot &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

### 4. Wrap up!

#### 4. Reshape data

&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; share_tertiary &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; share_gdp &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FRA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.69 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.40 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; USA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.52 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.21 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

--

&lt;p style = margin-bottom:1.25cm;"&gt;&lt;/p&gt;


```r
data %&gt;% pivot_longer(c(share_tertiary, share_gdp), names_to = "Variable", values_to = "Value")
```

&lt;p style = margin-bottom:1.25cm;"&gt;&lt;/p&gt;

--

&lt;table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;"&gt;
&lt;caption&gt;&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; country &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; year &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Variable &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FRA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_tertiary &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 44.69 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; FRA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_gdp &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.40 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; USA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_tertiary &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 46.52 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; USA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2015 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; share_gdp &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.21 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

### For next time

&lt;p style = margin-bottom:4cm;"&gt;&lt;/p&gt;

&lt;center&gt;&lt;b&gt;&lt;u&gt;Install the R packages needed for Part I of the course:&lt;/u&gt;&lt;/b&gt;&lt;/center&gt;

&lt;p style = margin-bottom:1cm;"&gt;&lt;/p&gt;

&lt;center&gt;&lt;b&gt;ggplot2&lt;/b&gt;&lt;/center&gt;
&lt;p style = margin-bottom:.15cm;"&gt;&lt;/p&gt;
&lt;center&gt;&lt;b&gt;rmarkdown&lt;/b&gt;&lt;/center&gt;
&lt;p style = margin-bottom:.15cm;"&gt;&lt;/p&gt;
&lt;center&gt;&lt;b&gt;knitr&lt;/b&gt;&lt;/center&gt;
&lt;p style = margin-bottom:.15cm;"&gt;&lt;/p&gt;
&lt;center&gt;&lt;b&gt;DT&lt;/b&gt;&lt;/center&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<style>
.logo {
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  top: 1em;
  right: 1em;
  z-index: 0;
 width: 10px;
  height: 10px;
   background: #DFE6EB;
  border-radius: 80px;
  text-align:left;
  padding:24px;
  box-shadow: 4px 4px 6px #F3F5F7, 
              -4px -4px 6px #D8DEE3;
}

.logo:active {
  box-shadow: inset 4px 4px 6px #F3F5F7, 
              inset -4px -4px 6px #D8DEE3
}

</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    // ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"><a href = "https://louissirugue.github.io/metrics_on_R/home_dark.html"><p style = "margin-left:-.55cm;margin-top:-.55cm;width:53px"> <img src = "../source/home2.png"> </p> </a></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
